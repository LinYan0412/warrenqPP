<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>é™†å®¶å˜´ç²¾è£…æˆ¿ç§Ÿèµ - é«˜ç«¯DEMO</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd-mobile@5.29.1/es/global/global.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@6.5.0/css/all.min.css">
  <style>
    html,body {background: #eaeef7; margin: 0; padding: 0;}
    body {font-family: 'PingFang SC','Segoe UI','Helvetica Neue',Arial,'å¾®è½¯é›…é»‘',sans-serif;}
    .main{max-width:500px;min-height:100vh;margin:auto;background:#fff;
      box-shadow:0 2px 28px #bcd8fa42;border-radius:22px 22px 0 0;position:relative;}
    .main::-webkit-scrollbar{display:none;}
    .app-header{
      background: linear-gradient(108deg, #96eaff 0%, #6a77ff 40%, #b769ed 100%);
      color:#fff;text-align:center;padding:32px 0 20px 0;border-radius:22px 22px 0 0;
      font-size:24.5px;letter-spacing:2px;font-weight:600;
      box-shadow:0 2px 12px 0 #b2bff6a9;position: relative;
    }
    .user-avatar{background:#fafafa;border-radius:50%;width:55px;height:55px;display:flex;align-items:center;justify-content:center;margin:auto;font-size:31px;margin-bottom:10px;}
    /* --- ç™»å½•--- */
    .login-card{margin:45px 18px 0 18px;background:rgba(255,255,255,.98);box-shadow:0 2px 22px #c2d6fc34;border-radius:21px;padding:26px;max-width:345px;}
    .login-ipt{width:88%;margin:12px auto 5px auto;font-size:16.5px;padding:8px 13px;border-radius:14px;border:1.2px solid #dde8f8;outline:none;}
    .login-btn{margin-top:19px;width:100%;background:linear-gradient(90deg,#5ad7e7 0,#8e6aec 80%);color:#fff;font-size:17px;padding:10px;border-radius:15px;border:none;box-shadow:0 2px 9px #d2dbff81;font-weight:bold;cursor:pointer;}
    /* --- æˆ¿æºé¡µ/å¡--- */
    .filter-tabs{display:flex;gap:8px;margin:12px 16px;}
    .f-tab{padding:6px 16px;border-radius:13px;font-size:15px;color:#4a7df7;background:#f3f6ff;cursor:pointer;}
    .f-tab.act{color:#fff;background:linear-gradient(82deg,#60d1f8 0,#a574ec 90%);box-shadow:0 2px 12px #acdefe43}
    .search-bar{margin:0 14px 16px 14px;}
    .search-inp{width:98%;background:#f4f7fd;border-radius:15px;outline:none;border:none;padding:10px 14px;font-size:16.5px;color:#1677ff;margin:6px 0;}
    .plus-btn{position:fixed;right:19px;bottom:90px;background:linear-gradient(90deg,#67daf8 0,#a874ff 80%);
      color:#fff;border-radius:50%;width:56px;height:56px;display:flex;align-items:center;justify-content:center;
      box-shadow:0 2px 11px #b8eafd70;font-size:36px;border:none;z-index:99; cursor:pointer;}
    .card{background:#fff;margin:17px 14px 0 14px;border-radius:18px;box-shadow:0 2px 17px #e0ebfd;
      overflow:hidden;position:relative;transition:.22s;}
    .piccover{width:100%;height:182px;object-fit:cover;transition:.13s;}
    .badge{position:absolute;left:14px;top:12px;background:linear-gradient(90deg,#fffeff 30%,#aef4fe85 90%);
      color:#2c65bc;border-radius:11px;font-size:13px;padding:2px 14px;box-shadow:0 1px 7px #e3f1ff36;font-weight:500;}
    .fav{position:absolute;right:19px;top:13px;cursor:pointer;font-size:22px;color:#e9a9c2;background:#fffbe7b9;padding:2px 11px;border-radius:55%;z-index:3;transition:.14s;}
    .fav.selected{color:#de486a;background:#fdf0f7;}
    .info{padding:14px 16px 11px 14px;}
    .title{font-size:18px;font-weight:600;color:#315292;margin-bottom:1px;}
    .brief{color:#497cc2;font-size:13.5px;margin:6px 0 0 0;}
    .meta{margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;font-size:14px;color:#8595bb;}
    .view-btns{display:flex;gap:12px;}
    .view-btn{
      background:#f8faff;color:#34487c;font-size:14px;border-radius:13px;padding:5px 14px;border:none;font-weight:500;box-shadow:0 1px 6px #e6e9fb87;cursor:pointer; transition:.05s;
    }
    .view-btn:hover,.room-btn:hover {background:#e4dbfa;color:#855dee;}

    .price{font-size:20px;font-weight:700;color:#54b2ff;float:right;margin-top:-4px;}
    .highlights{margin-top:8px;display:flex;gap:7px;overflow-x:auto;}
    .highlights span{background:linear-gradient(90deg,#e2f9ff 0,#ece2fc 90%);padding:3px 13px;border-radius:15px;font-size:12px;color:#7a48c0;}
    /* ------ è¯¦æƒ…å¼¹çª— ------ */
    .mask{position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:201;background:rgba(36,43,79,.30);animation:fadein .36s;}
    @keyframes fadein{from{opacity:0}to{opacity:1}}
    .popup{position:fixed;left:0;right:0;top:56px;margin:auto;max-width:440px;width:95vw;background:#fff;z-index:202;
      border-radius:22px;box-shadow:0 6px 40px #7e88af19;overflow-y:auto;max-height:87vh;
      animation:popupin .38s cubic-bezier(.21,1.37,.2,.95);}
    @keyframes popupin{from{transform:scale(.94) translateY(140px)}to{transform:scale(1) translateY(0px)}}
    .pimgs{display:flex;gap:7px;overflow-x:auto;margin:13px 0;}
    .pimgs img{height:102px;width:140px;object-fit:cover;border-radius:12px;}
    .ptitle{font-size:21px;margin-bottom:8px;color:#25397c;}
    .pdesc{font-size:15.5px;color:#454968;margin:7px 0 7px 0}
    .popup-btns{margin:15px 0 14px 0;display:flex;gap:8px;}
    .popup-btn{flex:1;padding:8px 0;border-radius:15px;font-size:16px;box-shadow:0 2px 11px #d7e5fd4f;border:none;cursor:pointer;font-weight:600;}
    .popup-btn.blue{background:linear-gradient(90deg,#49d8ef 0,#8f5df5 100%);color:#fff;}
    .popup-btn.gray{background: #d1d9ef;color:#5c6b91;}
    /* ---- TabBar ---- */
    .tabbar{position:fixed;left:0;right:0;bottom:0;max-width:500px;margin:auto;height:61px;z-index:1902;
      display:flex;align-items:center;justify-content:space-around;background:linear-gradient(90deg,#eef6ff 0,#ede9fb 100%);
      border-radius:25px 25px 0 0;box-shadow:0 -2px 15px #bad3f926;}
    .tabicon{padding-top:4px;font-size:21.5px;}
    .tab-label{font-size:13px;}
    .tbar{padding:7px 0 0 0;flex:1;text-align:center;color:#8e9cc2;cursor:pointer;}
    .tbar.sel{color:#6a36ec;font-weight:600;}
    /* --- ä¸ªäººä¸­å¿ƒ---- */
    .center-card {
      margin:32px 14px 80px 14px; border-radius:20px; background:rgba(230,240,255,0.93); box-shadow:0 2px 25px #deeefd55;padding:26px 16px 18px 16px;max-width:400px;}
    .c-title{font-size:22px;font-weight:bold;color:#384f84;margin-bottom:18px;}
    .c-row{margin-bottom:15px;font-size:15.5px;color:#4e68ac;}
    .c-row label{color:#aaa;margin-right:8px;}
    .center-listbox{margin-top:19px;}
    .listentry{background:#fff;margin-bottom:9px;padding:13px 12px 9px 16px;color:#465a94;border-radius:14px;
      box-shadow:0 2px 9px #e4eafd44;}
    .listentry .ehd{font-weight:600;margin-bottom:3px;}
    .home-btn{margin-top:23px;width:98%;background:linear-gradient(90deg,#57d7ef 0,#a074ff 80%);color:#fff;font-size:16px;padding:8px;border-radius:13px;border:none;box-shadow:0 2px 6px #cfd3fb61;font-weight:bold;cursor:pointer;}
    .edit-ipt{padding:8px 13px;border-radius:12px;border:1.3px solid #dae4f6;outline:none;font-size:15.5px;margin-top:5px;width:90%;}
    /* --- skeleton --- */
    .skeleton{animation:sk1 1.3s infinite alternate;background:#f2f4f9;}
    @keyframes sk1{from{opacity:.66}to{opacity:1}}
    @media (max-width:600px){
      .main{border-radius:0;}
      .tabbar{max-width:100vw;}
    }
  </style>
</head>
<body ontouchstart="">
  <div class="main" id="mainbox">
    <div class="app-header"><i class="fa-solid fa-house-signal"></i>&nbsp;é™†å®¶å˜´ç²¾è£…æˆ¿ç§Ÿèµ</div>
    <div id="appview"></div>
  </div>
  <div id="tabBar"></div>
  <div id="popupBox"></div>
  <script>
  // -------- æˆ¿æºæ•°æ®ï¼Œæ¯æ¡ä¸å°‘äº10ä¸ª
  let houseList=[
    {
      id:1,title:"ä¸–çºªå¤§é“Â·ä¸¤å±…è‡»äº«ç²¾è£…",badge:"æ™ºèƒ½æ¨è",imgs:[
        "https://images.unsplash.com/photo-1506744038136-46273834b3fb",
        "https://images.unsplash.com/photo-1460518451285-97b6aa326961"
      ],video:"https://vd3.bdstatic.com/mda-nchfrf5144q3s1gi/sc/cae_h264_nowatermark/1670292794236137452/mda-nchfrf5144q3s1gi.mp4",
      size:78,rooms:"2å®¤1å…",level:"27å±‚é«˜åŒº",metro:"ä¸–çºªå¤§é“ 500m",highlight:["æ™ºèƒ½å®¶å±…","é˜³å°è½åœ°çª—","å…¨å±‹å®¶ç”µ"],
      desc:"è¿‘åœ°é“2/4/6/9å·çº¿ï¼Œæ™ºèƒ½é—¨é”ã€ä¸­å¤®ç©ºè°ƒã€æ™ºèƒ½ç…§æ˜ï¼Œå…¨å±‹å®¶å…·å®¶ç”µï¼Œé‡‡å…‰æå¥½ï¼Œæ‹åŒ…å…¥ä½ã€‚",
      landlord:"å¼ å¥³å£«",phone:"13812341234",tag:["æ™ºèƒ½æ¨è","åœ°é“æˆ¿","æ‹åŒ…å…¥ä½"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:2,title:"å…«ä½°ä¼´ä¸€å®¤ä¸€å… æ±Ÿæ™¯æ ‡é…",badge:"æ±Ÿæ™¯",imgs:[
        "https://images.unsplash.com/photo-1416339306562-f3d12fefd36f"
      ],video:"https://vd3.bdstatic.com/mda-n8lx81f9i5u50x5q/sc/cae_h264_nowatermark/1592299308647425592/mda-n8lx81f9i5u50x5q.mp4",
      size:55,rooms:"1å®¤1å…",level:"ä¸­æ¥¼å±‚",metro:"å•†åŸè·¯ 200m",highlight:["æ±Ÿæ™¯æˆ¿","ç‹¬ç«‹å«æµ´","æ™ºèƒ½é—¨é”"],desc:"æ­£å¤§å¹¿åœºæ—ï¼Œç²¾è£…ä¸€å±…ï¼Œè½åœ°çª—æ±Ÿæ™¯ï¼Œå®¶ç”µé½å…¨ï¼Œå®‰ä¿24å°æ—¶ã€‚",
      landlord:"ä¸‡å®¶åœ°äº§",phone:"15266668888",tag:["æ±Ÿæ™¯","æ™ºèƒ½æ¨è"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:3,title:"é™†å®¶å˜´ä¸‰æˆ¿ç²¾è£…å¤§éœ²å°",badge:"åœ°é“æˆ¿",imgs:[
        "https://images.unsplash.com/photo-1484154218962-a197022b5858",
        "https://images.unsplash.com/photo-1496462682066-ecce803295ee"
      ],video:"https://vd4.bdstatic.com/mda-mk3w5k43cmjif8j9/sc/mda-mk3w5k43cmjif8j9.mp4",
      size:96,rooms:"3å®¤2å…",level:"19å±‚",metro:"ä¸œæ˜Œè·¯ 300m",highlight:["å¤§éœ²å°","é›†ä¸­ä¾›æš–","å…ä¸­ä»‹"],
      desc:"å—åŒ—é€šé€ï¼Œç²¾è£…å…¨é…ï¼Œæˆ¿ä¸œç›´ç§Ÿï¼Œæ­¥è¡Œ5åˆ†é’Ÿåœ°é“ã€‚å¸¦è¶…å¤§éœ²å°ã€‚",
      landlord:"æå…ˆç”Ÿ",phone:"14722221111",tag:["åœ°é“æˆ¿","æ‹åŒ…å…¥ä½"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:4, title:"æ­£å¤§å¹¿åœºå…¨æ™¯æ±Ÿæ™¯å¤§å®…",badge:"æ±Ÿæ™¯",imgs:[
        "https://images.unsplash.com/photo-1512918728675-ed5a9ecdebfd"
      ],video:"https://vd3.bdstatic.com/mda-mbe343k634ca951r/sc/cae_h264/1540554535/mda-mbe343k634ca951r.mp4",
      size:110,rooms:"3å®¤2å…",level:"33å±‚é¡¶å±‚",metro:"é™†å®¶å˜´ 600m",highlight:["å…¨æ™¯é˜³å°","å¯çŸ­ç§Ÿ","æ±Ÿæ™¯"],
      desc:"é™†å®¶å˜´é»„é‡‘åœ°æ®µè¶…é«˜å±‚å…¨æ™¯æ±Ÿæ™¯ã€‚å¸¦è§‚æ™¯é˜³å°ï¼Œæ™ºèƒ½é—¨é”ã€‚",landlord:"ç‹å¥³å£«",phone:"13618889999",tag:["æ±Ÿæ™¯"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:5, title:"é™†å®¶å˜´ç²¾è£…ä¸€å±… éšæ—¶çœ‹æˆ¿",badge:"æ™ºèƒ½æ¨è", imgs:[
        "https://images.unsplash.com/photo-1560448075-bb0bff1e1c8b"
      ],video:"https://vd3.bdstatic.com/mda-mk3w5n8f6uulbnax/sc/mda-mk3w5n8f6uulbnax.mp4",
      size:39,rooms:"1å®¤0å…",level:"16å±‚",metro:"æµ¦ç”µè·¯ 700m",highlight:["å®¶ç”µé½","æ™ºèƒ½é—¨é”","è¿‘åœ°é“"],
      desc:"å°æˆ·å‹å…¨é…ï¼Œä¸ªäººå‡ºç§Ÿï¼Œå®‰é™ä¾¿åˆ©ï¼Œå‡ºå°åŒºå³åœ°é“å…¥å£ã€‚",
      landlord:"å­™é˜¿å§¨",phone:"13511223344",tag:["æ™ºèƒ½æ¨è","å¯çŸ­ç§Ÿ"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:6, title:"æ»¨æ±Ÿåå· é«˜ç«¯å¤å¼å¯3Dçœ‹æˆ¿",badge:"3Dæ ·æ¿", imgs:[
        "https://images.unsplash.com/photo-1507089947368-19c1da9775ae"
      ],video:"https://vd3.bdstatic.com/mda-mk3w5ln6jkej213k/sc/mda-mk3w5ln6jkej213k.mp4",
      size:120,rooms:"4å®¤2å…",level:"23å±‚å¤å¼",metro:"æµ¦ä¸œå¤§é“ 900m",highlight:["å¤å¼","è¿‘æ±Ÿæ™¯","3Då…¨æ™¯çœ‹æˆ¿"],
      desc:"æ»¨æ±Ÿé«˜æ¡£å°åŒºï¼Œçœ‹æ±Ÿé¦–é€‰ï¼Œç‹¬ç«‹å¨æˆ¿å«ï¼Œæ”¯æŒ3Dåœ¨çº¿çœ‹æ ·æ¿ã€‚",
      landlord:"ä¸œå²¸èµ„äº§",phone:"13566778899",tag:["3Dçœ‹æˆ¿"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:7, title:"ä¸–çºªå…¬å¯“ æœå—ç”µæ¢¯æˆ¿", badge:"åœ°é“æˆ¿",imgs:[
        "https://images.unsplash.com/photo-1449844908441-8829872d2607"
      ],video:"https://vd3.bdstatic.com/mda-mhv5fv9em1h7pnac/sc/mda-mhv5fv9em1h7pnac.mp4",
      size:62,rooms:"2å®¤1å…",level:"7å±‚",metro:"ä¸–çºªå¤§é“ 400m",highlight:["é…ç½®å…¨","æ‹åŒ…å…¥ä½"],desc:"å—æœå…¨å¤©é‡‡å…‰ï¼Œæ— éš”æ–­ï¼Œç”Ÿæ´»ä¾¿åˆ©ï¼Œåœ°é“å£æ­¥è¡Œå³è¾¾ã€‚",
      landlord:"æç»ç†",phone:"13890009000",tag:["åœ°é“æˆ¿","æ‹åŒ…å…¥ä½"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:8, title:"å…«ä½°ä¼´ç²¾è‡´å°å¤å¼", badge:"åœ°é“æˆ¿",imgs:[
        "https://images.unsplash.com/photo-1519710164239-da123dc03ef4"
      ],video:"https://vd3.bdstatic.com/mda-mgp9uz3qvvaidkmp/sc/mda-mgp9uz3qvvaidkmp.mp4",
      size:47,rooms:"1å®¤0å…",level:"å¤å¼",metro:"å•†åŸè·¯ 350m",highlight:["å¤å¼","æ‹åŒ…å…¥ä½"],desc:"å®‰é™æ¥¼æ ‹å°å¤å¼ï¼Œæ€§ä»·æ¯”æä½³ï¼Œæ‹åŒ…å³å¯å…¥ä½ã€‚",
      landlord:"èµµæˆ¿ä¸œ",phone:"13966668888",tag:["åœ°é“æˆ¿"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:9, title:"ä¸œæ˜Œä¸‰å±…ç²¾è£… æ–°å“ä¸Šçº¿", badge:"æ™ºèƒ½æ¨è",imgs:[
        "https://images.unsplash.com/photo-1512918728675-ed5a9ecdebfd"
      ],video:"https://vd3.bdstatic.com/mda-mgim9z14glv2n32q/sc/mda-mgim9z14glv2n32q.mp4",
      size:97,rooms:"3å®¤2å…",level:"22å±‚",metro:"ä¸œæ˜Œè·¯ 200m",highlight:["æ–°ä¸Šæˆ¿æº","ç²¾è£…","è¿‘åœ°é“"],
      desc:"æ–°ä¸Šæ— ä¸­ä»‹ä¸‰æˆ¿ï¼Œå©šæˆ¿é¦–é€‰ï¼Œé‡‡å…‰æ— æ•Œï¼Œç‹¬ç«‹å¨æˆ¿ã€‚",
      landlord:"ç»çºªäºº-å°é™ˆ",phone:"13788997766",tag:["æ™ºèƒ½æ¨è","åœ°é“æˆ¿"],fav:false,views:0,vr:"https://ke.com/3d"
    },
    {
      id:10, title:"åˆç”Ÿå›½é™…ååº­å“è´¨ä¸¤æˆ¿", badge:"æ‹åŒ…å…¥ä½",imgs:[
        "https://images.unsplash.com/photo-1465101178521-c1a9136a1bcc"
      ],video:"https://vd3.bdstatic.com/mda-mhacbscj5yy1sysa/sc/mda-mhacbscj5yy1sysa.mp4",
      size:74,rooms:"2å®¤1å…",level:"13å±‚",metro:"æµ¦ä¸œå¤§é“ 800m",highlight:["å®¶ç”µå…¨é…","æ‹åŒ…å…¥ä½"],desc:"å“è´¨ç¤¾åŒºï¼Œæ‹åŒ…å…¥ä½ï¼Œç”Ÿæ´»ä¾¿åˆ©èˆ’é€‚ã€‚",landlord:"åˆç”Ÿç‰©ä¸š",phone:"13144556677",tag:["æ‹åŒ…å…¥ä½"],fav:false,views:0,vr:"https://ke.com/3d"
    }
  ];
  // -------- ç”¨æˆ·ä½“ç³» ----------
  const demoUsers = [
    {id:1,role:"renter",username:"123456",password:"123456",nick:"ç§Ÿæˆ¿ä½“éªŒç”¨æˆ·",avatar:"ğŸ‘©â€ğŸ’¼",hist:[],fav:[]},
    {id:2,role:"landlord",username:"234567",password:"234567",nick:"æˆ¿ä¸œä½“éªŒè´¦å·",avatar:"ğŸ§‘â€ğŸ’»",publish:[1,3,7]}
  ];
  // -------- é¡µé¢çŠ¶æ€
  let curUser = null; // å½“å‰ç”¨æˆ·ä¿¡æ¯
  let curPage = "login"; // é¡µé¢ home/publish/mine/login
  let tabIdx = 0;        // æˆ¿æºfilter
  let searchVal = "";
  let popupId = null;    // å½“å‰å¼¹çª—æˆ¿æºid
  function saveLS(){localStorage.setItem("userData",JSON.stringify(curUser||{}));}
  function tryLoadUser(){ let u=localStorage.getItem("userData");if(u&&u!=='{}'){curUser=JSON.parse(u);} }
  tryLoadUser();

  // ----------- æ¸²æŸ“ä¸»è§†å›¾ begin --------------
  function renderMain(){
    let v = document.getElementById("appview");
    let bar = document.getElementById("tabBar");
    // ç™»å½•é¡µ
    if(!curUser){
      curPage="login";
      v.innerHTML = `
      <div class="login-card" style="animation:fadein .38s;"><div style="text-align:center;margin-bottom:18px;font-size:21px;">
        <div class="user-avatar" style="background:#e7e8fd"><i class="fa fa-circle-user"></i></div>
        <b>é™†å®¶å˜´ç²¾è£…æˆ¿ç§Ÿèµ</b>
      </div>
      <form onsubmit="onLogin(event)">
        <input class="login-ipt" placeholder="ç”¨æˆ·å" id="lg-username" maxlength="20" required /><br>
        <input class="login-ipt" type="password" placeholder="å¯†ç " id="lg-pw" maxlength="20" required /><br>
        <button class="login-btn">ç™»å½•</button>
      </form>
      <div style="margin-top:17px;color:#777;font-size:14px;line-height:1.9;">
        <b>æ‰¿ç§Ÿäºº</b> è´¦å·ï¼š<span style="color:#1ab7be">123456</span> å¯†ç ï¼š<span style="color:#1ab7be">123456</span><br>
        <b>å‡ºç§Ÿäºº</b> è´¦å·ï¼š<span style="color:#b27ff3">234567</span> å¯†ç ï¼š<span style="color:#b27ff3">234567</span>
      </div>
      `;
      renderTabBar();
      return;
    }
    // è·¯ç”±é¡µé¢
    if(curPage==="home"){ // æ‰¿ç§Ÿäºº-æˆ¿æºé¡µ
      let filterTabs = ["å…¨éƒ¨æˆ¿å‹","æ™ºèƒ½æ¨è","åœ°é“æˆ¿","æ±Ÿæ™¯","3Dçœ‹æˆ¿","æ‹åŒ…å…¥ä½"];
      let navTab = filterTabs.map((t,i)=>
        `<div class="f-tab${tabIdx==i?' act':''}" onclick="tabSel(${i})">${t}</div>`
      ).join("");
      let list = houseList.slice();
      if(tabIdx>0) list = list.filter(x=> x.tag?.includes(filterTabs[tabIdx]));
      if(searchVal) list = list.filter(l=>(l.title+l.desc+l.rooms+l.metro+l.highlight?.join('')).includes(searchVal));
      v.innerHTML=`
        <div class="filter-tabs">${navTab}</div>
        <div class="search-bar">
          <input class="search-inp" id="searInp" placeholder="æœç´¢ï¼šåœ°é“/ç‰¹å¾" value="${searchVal||''}" />
        </div>
        <div id="roomList"></div>
        <button class="plus-btn" style="display:none"><i class="fa fa-plus"></i></button>
      `;
      setTimeout(()=>{document.getElementById("searInp").oninput=function(){searchVal=this.value.trim();renderMain()}})
      renderRoomList(list);
      renderTabBar();
      return;
    }
    if(curPage==="publish"){ // å‡ºç§Ÿäºº-å‘å¸ƒé¡µ
      let myIds = curUser.publish||[];
      let myRooms = houseList.filter(r=>myIds.includes(r.id));
      v.innerHTML=`
      <div class="center-card" style="margin-top:30px;padding:22px;">
        <div class="c-title">æˆ‘çš„å·²å‘å¸ƒæˆ¿æº</div>
        <div class="center-listbox">${myRooms.length?myRooms.map(r=>`
          <div class="listentry">
            <div class="ehd"><span style="color:#678fff"><i class="fa fa-house-user"></i> ${r.title}</span></div>
            <div>${r.rooms} Â· ${r.size}ã¡ Â· ${r.level} / ${r.metro}</div>
            <div class="highlights">${r.highlight.map(t=>`<span>${t}</span>`).join('')}</div>
            <div>é¢„çº¦ç”µè¯ï¼š<a href="tel:${r.phone}" style="color:#158eef">${r.phone}</a></div>
          </div>
        `).join(""):`<div style="color:#aea">æš‚æ— å‘å¸ƒæˆ¿æºï¼ˆæ¼”ç¤ºè´¦å·ï¼‰</div>`}
      </div>
      <div style="padding:0 22px 30px 22px;text-align:center"><button class="home-btn"
        onclick="renderMain();curPage='new';">â• å‘å¸ƒæ–°æˆ¿æºï¼ˆDEMOï¼‰</button></div>
      `;
      renderTabBar();
      return;
    }
    if(curPage==="mine"){ // ä¸ªäººä¸­å¿ƒ
      let hist = curUser.hist||[];
      let favs = curUser.fav||[];
      let pub = [];
      if(curUser.role==='landlord') pub=curUser.publish||[];
      v.innerHTML=`
      <div class="center-card">
        <div class="user-avatar" style="font-size:41px;box-shadow:0 1px 9px #bebeda57">${curUser.avatar||"ğŸ‘¤"}</div>
        <div class="c-title">${curUser.nick} <span style="font-size:15px;color:#c6aafb;">${curUser.role==='landlord'?'å‡ºç§Ÿäºº':'æ‰¿ç§Ÿäºº'}</span></div>
        <div class="c-row"><label>è´¦å·ï¼š</label>${curUser.username}</div>
        <div class="c-row"><label>æ˜µç§°ï¼š</label><input class="edit-ipt" style="width:55%" value="${curUser.nick||""}" id="editNick" onchange="updateNick(this.value)"></div>
        <div class="c-row"><label>èº«ä»½ï¼š</label>${curUser.role==='landlord'?'æˆ¿ä¸œ/å…¬å¸ï¼ˆæ”¯æŒå‘å¸ƒ/ç®¡ç†æˆ¿æºï¼‰':'æ‰¿ç§Ÿäººï¼ˆå¯é¢„çº¦/æ”¶è—/3Dçœ‹æˆ¿ï¼‰'}</div>
        <button class="home-btn" onclick="onLogout()">é€€å‡ºç™»å½•</button>
        <div class="center-listbox">
          <div class="listentry">
            <div class="ehd"><i class="fa fa-eye"></i> æµè§ˆè®°å½•</div>
            <div style="font-size:14px;color:#888">${(hist.length?pageList(hist):"<i style='color:#aaa'>æš‚æ— æµè§ˆè®°å½•</i>")}</div>
          </div>
          <div class="listentry">
            <div class="ehd"><i class="fa fa-heart"></i> æˆ‘çš„æ”¶è—</div>
            <div style="font-size:14px;color:#888">${(favs.length?pageList(favs):"<i style='color:#aaa'>æš‚æ— æ”¶è—</i>")}</div>
          </div>
          ${curUser.role==='landlord'?`<div class="listentry">
            <div class="ehd"><i class="fa fa-house-circle-check"></i> æˆ‘å‘å¸ƒçš„æˆ¿æº</div>
            <div style="font-size:14px;color:#888">${(pub.length?pageList(pub):"<i style='color:#aaa'>æš‚æ— è®°å½•</i>")}</div>
          </div>`:""}
        </div>
      </div>
      `;
      renderTabBar();
      return;
    }
    if(curPage==="new"){ // å‘å¸ƒï¼ˆåªæ¼”ç¤ºè¡¨å•ï¼Œæ•°æ®ä¸å¯æŒä¹…å­˜å‚¨ï¼‰
      v.innerHTML=`
      <div class="center-card" style="margin-top:30px;max-width:400px;padding:27px;">
        <div class="c-title">å‘å¸ƒæ–°æˆ¿æºï¼ˆæ¼”ç¤ºï¼‰</div>
        <form onsubmit="alert('DEMOä¸æ”¯æŒå®é™…å‘å¸ƒ');curPage='publish';renderMain();return false;">
          <input class="edit-ipt" required placeholder="æˆ¿æºæ ‡é¢˜ï¼ˆå¦‚ä¸–çºªå¤§é“ä¸‰æˆ¿ï¼‰" /><br>
          <input class="edit-ipt" required placeholder="æˆ¿å‹å¦‚2å®¤1å…" /><br>
          <input class="edit-ipt" type="number" required placeholder="é¢ç§¯ã¡" /><br>
          <input class="edit-ipt" required placeholder="ä»·æ ¼å…ƒ/æœˆ" /><br>
          <textarea class="edit-ipt" rows="2" placeholder="æˆ¿æºæè¿°"></textarea><br>
          <button class="home-btn" style="margin-top:17px;">æäº¤å‘å¸ƒï¼ˆä»…æ¼”ç¤ºï¼‰</button>
          <button class="home-btn" style="background:#e7e8fd;color:#888;margin-top:7px;" onclick="curPage='publish';renderMain();return false;">è¿”å›</button>
        </form>
      </div>
      `;
      renderTabBar();
      return;
    }
  }
  // --- æ¸²æŸ“æˆ¿æºåˆ—è¡¨
  function renderRoomList(list){
    let box = document.getElementById('roomList');
    if(!list.length) {box.innerHTML = `<div class="card skeleton" style="text-align:center;padding:35px">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æˆ¿æº</div>`;return;}
    box.innerHTML = list.map(l=>`
      <div class="card" style="animation:fadein .33s;">
        <img class="piccover" src="${l.imgs[0]}" loading="lazy" onclick="onViewDetail(${l.id})" />
        <div class="badge">${l.badge}</div>
        <div class="fav${ isFav(l.id)?' selected':''}" onclick="onFav(event,${l.id})">
          <i class="fa${isFav(l.id)?'-solid':'-regular'} fa-heart"></i></div>
        <div class="info" onclick="onViewDetail(${l.id})">
          <div><span class="title">${l.title}</span><span class="price">${l.price}å…ƒ/æœˆ</span></div>
          <div class="brief">${l.rooms} Â· ${l.size}ã¡ Â· ${l.level} / ${l.metro}</div>
          <div class="highlights">${l.highlight.map(t=>`<span>${t}</span>`).join('')}</div>
          <div class="meta">
            <span class="meta-btn"><i class="fa fa-video"></i> è§†é¢‘</span>
            <span class="meta-btn"><i class="fa fa-vr-cardboard"></i> 3Dçœ‹æˆ¿</span>
          </div>
          <div class="view-btns">
            <button class="view-btn" onclick="event.stopPropagation();onViewDetail(${l.id})">æŸ¥çœ‹è¯¦æƒ…</button>
            <button class="view-btn" onclick="event.stopPropagation();onReserve(${l.id})">é¢„çº¦çœ‹æˆ¿</button>
          </div>
        </div>
      </div>
    `).join('');
  }
  // --- æ¸²æŸ“åº•éƒ¨TabBar
  function renderTabBar(){
    let tb = document.getElementById('tabBar');
    if(!curUser){
      tb.innerHTML="";
      return;
    }
    let tbset = []; // tbar:[å›¾æ ‡,æ–‡æœ¬,é¡µé¢å]
    if(curUser.role==='renter')
      tbset = [["fa-solid fa-magnifying-glass","æ‰¾æˆ¿æº","home"],["fa-solid fa-user","æˆ‘çš„","mine"]];
    else
      tbset = [["fa-solid fa-file-signature","å‘å¸ƒæˆ¿æº","publish"],["fa-solid fa-user","æˆ‘çš„","mine"]];
    tb.innerHTML = tbset.map(([ic,tt,page],i)=>
      `<div class="tbar${curPage===page?' sel':''}" onclick="curPage='${page}';renderMain()">
        <div class="tabicon"><i class="${ic}"></i></div>
        <div class="tab-label">${tt}</div>
      </div>`).join('');
  }
  // --- è¯¦æƒ…å¼¹çª—
  function renderPopup(){
    let ppbox = document.getElementById("popupBox");
    if(!popupId){ppbox.innerHTML="";return;}
    let d = houseList.find(x=>x.id===popupId);
    if(!d)return;
    let vidBtn = d.video?`<button class="popup-btn gray" onclick="showVideo('${d.video}')"><i class="fa fa-video"></i> æˆ¿æºè§†é¢‘</button>`:'';
    let vrBtn = d.vr?`<button class="popup-btn gray" onclick="gotoVr('${d.vr}')"><i class="fa fa-cube"></i> 3Dçœ‹æˆ¿</button>`:'';
    ppbox.innerHTML=`
      <div class="mask" onclick="popupId=null;renderPopup()"></div>
      <div class="popup">
        <div class="pimgs">${d.imgs.map(u=>`<img src="${u}" />`).join('')}</div>
        <div class="ptitle">${d.title} <span class="price">${d.price}å…ƒ/æœˆ</span></div>
        <div class="meta">${d.rooms} Â· ${d.size}ã¡ Â· ${d.level} / ${d.metro}</div>
        <div class="highlights">${d.highlight.map(t=>`<span>${t}</span>`).join('')}</div>
        <div class="pdesc">${d.desc}</div>
        <div style="color:#8a6">æˆ¿ä¸œ/å…¬å¸ï¼š${d.landlord}</div>
        <div class="popup-btns">
          <button class="popup-btn blue" onclick="callNow('${d.phone}')"><i class="fa fa-phone"></i> ç”µè¯é¢„çº¦</button>
          ${vidBtn} ${vrBtn}
          <button class="popup-btn gray" onclick="popupId=null;renderPopup()">å…³é—­</button>
        </div>
      </div>
    `;
  }
  function showVideo(url){
    popupMsg(`<video src="${url}" controls style="width:99%;max-width:420px;border-radius:13px" autoplay></video>`)
  }
  function gotoVr(url){
    window.open(url,"_blank");
  }
  function popupMsg(html){
    if(document.getElementById('msgpopup'))document.getElementById('msgpopup').remove();
    let el=document.createElement("div");el.id='msgpopup';
    el.style="position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:3100;background:#1a1a25c0;display:flex;align-items:center;justify-content:center;";
    el.onclick=function(){el.remove()}
    el.innerHTML=`<div style="background:#fff;border-radius:17px;padding:19px 13px;max-width:90vw">${html}</div>`;
    document.body.appendChild(el);
  }
  // ----------- äº‹ä»¶é€»è¾‘ begin -----------
  function onLogin(ev){
    ev.preventDefault();
    let u = document.getElementById('lg-username').value.trim();
    let p = document.getElementById('lg-pw').value.trim();
    let user = demoUsers.find(uinfo=>uinfo.username==u&&uinfo.password==p);
    if(!user){alert("è´¦å·æˆ–å¯†ç é”™è¯¯ï¼");return;}
    curUser = JSON.parse(JSON.stringify(user));
    saveLS();
    curPage = (curUser.role==="landlord"?"publish":"home");
    renderMain();
  }
  function onLogout(){
    curUser=null;saveLS();curPage="login";renderMain();
  }
  function onFav(e,id){
    e.stopPropagation();
    if(!curUser){alert("è¯·ç™»å½•å†æ”¶è—~");return;}
    if(!curUser.fav)curUser.fav=[];
    let i = curUser.fav.indexOf(id);
    if(i==-1)curUser.fav.push(id);else curUser.fav.splice(i,1);
    saveLS();renderMain();
  }
  function isFav(id){return curUser&&curUser.fav&&curUser.fav.includes(id);}
  function onViewDetail(id){
    popupId=id;
    renderPopup();
    if(curUser){
      if(!curUser.hist)curUser.hist=[];
      if(!curUser.hist.includes(id))curUser.hist.push(id);
      saveLS();
    }
  }
  function onReserve(id){
    if(!curUser){alert("è¯·ç™»å½•åé¢„çº¦");return;}
    popupMsg(`<div style="text-align:center;font-size:17px">
      <i class="fa fa-house-circle-check" style="color:#4cafaa;font-size:33px"></i><br>é¢„çº¦æˆåŠŸï¼<br>æˆ‘ä»¬ä¼šå°½å¿«è”ç³»æ‚¨ï¼
    </div>`);
    if(!curUser.hist)curUser.hist=[];
    if(!curUser.hist.includes(id))curUser.hist.push(id);
    saveLS();
  }
  function callNow(tel){window.location="tel:"+tel;}
  function tabSel(idx){ tabIdx=idx;renderMain(); }
  function updateNick(val){curUser.nick=val||curUser.username;saveLS();renderMain();}
  function pageList(arr){
    let l = (arr||[]).map(i=>{
      let r=houseList.find(x=>x.id==i);
      return r?`<span style="color:#5ba7f7"><i class="fa fa-home"></i> ${r.title}</span>`:''
    }).join("ï¼Œ ");
    return l||"<i style='color:#ccc'>æ— </i>";
  }

  // ----------- ç»‘å®šå…¨å±€ç”¨äºonclick
  window.onLogin=onLogin;window.onFav=onFav;window.onViewDetail=onViewDetail;window.onReserve=onReserve;
  window.tabSel=tabSel; window.onLogout=onLogout;window.renderMain=renderMain;window.updateNick=updateNick;
  window.callNow=callNow;window.popupId=null;window.renderPopup=renderPopup;
  window.showVideo=showVideo;window.gotoVr=gotoVr;window.popupMsg=popupMsg;

  // --------- å¯åŠ¨é¦–é¡µ ----------
  renderMain();
  setTimeout(()=>{
    renderPopup();
  },80);
  </script>
</body>
</html>